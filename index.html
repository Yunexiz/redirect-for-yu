<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preparing...</title>
    <style>
      body {
          background-size: cover;
          background-color: rgb(24, 24, 24);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100vh;
          margin: 0;
          font-family: Arial, sans-serif;
      }

      .loader {
          position: relative;
          width: 150px;
          height: 150px;
      }

      .center-circle {
          position: absolute;
          top: -10%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 30px;
          height: 30px;
          background: radial-gradient(
            circle, 
            #4a90e2,
            #3fbdd7,
            #50e3c2,
          );
          background-size: contain;
          border-radius: 50%;
          z-index: 2;
          animation: supernova 3s ease-in-out forwards;
      }

      .orbit-circle {
          position: absolute;
          top: -10%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 24px;
          height: 24px;
          background-color: white;
          border-radius: 50%;
          z-index: 3;
          animation: orbit 2s ease-in-out infinite;
      }

      .orbit-circle.opposite {
          z-index: 3;
          animation: orbit-opposite 2s ease-in-out infinite;
      }

      .orbit-path {
          position: absolute;
          top: -10%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 120px;
          height: 120px;
          border: 1px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
      }

      @keyframes orbit {
          0% {
              transform: translate(-50%, -50%) rotate(-90deg) translateX(60px) scale(1);
          }
          50% {
              transform: translate(-50%, -50%) rotate(90deg) translateX(60px) scale(0); 
          }
          100% {
              transform: translate(-50%, -50%) rotate(270deg) translateX(60px) scale(1);
          }
      }

      @keyframes orbit-opposite {
          0% {
              transform: translate(-50%, -50%) rotate(90deg) translateX(60px) scale(1);
          }
          50% {
              transform: translate(-50%, -50%) rotate(270deg) translateX(60px) scale(0);
          }
          100% {
              transform: translate(-50%, -50%) rotate(450deg) translateX(60px) scale(1);
          }
      }

      @keyframes supernova {
          0% {
              transform: translate(-50%, -50%) scale(1);
          }
          25% {
              transform: translate(-50%, -50%) scale(3);
          }
          75% {
              transform: translate(-50%, -50%) scale(0);
          }
          100% {
              transform: translate(-50%, -50%) scale(4);
          }
      }

      span {
          position: absolute;
          font-size: 30px;
          margin: 0 auto;
          top: 50%;
          background: linear-gradient(to right,
          #fff 30%,
          #4a90e2 45%,
          #3fbdd7 50%,
          #50e3c2 55%,
          #fff 75%
          );
          background-size: 250% auto;
          background-clip: text;
          -webkit-background-clip: text;
          color: transparent;
          -webkit-text-fill-color: transparent;
          animation: shine 2s linear infinite;
      }

      @media (max-width: 768px) {
        span {
          top: 60%;
        }
      }

      @keyframes shine {
        0% {
          background-position: 120% 0;
        }
        100% {
          background-position: -20% 0;
        }
      }
    </style>

    <noscript>
      <meta http-equiv="refresh" content="3;url=https://yunexiz.is-a.dev" />
    </noscript>
    <script>
      let startTime = Date.now();
      let timeoutId;
      const urlParams = new URLSearchParams(window.location.search);

      timeoutId = setTimeout(() => {
        urlParams.set("profileUrl", "/assets/images/pfp.webp");
        const redirectUrl = `https://yunexiz.is-a.dev?${urlParams.toString()}`;
        window.location.replace();
      }, 3000);

      async function prefetchProfile() {
        try {
          let profileUrl = "/assets/images/pfp.webp";
          await fetch("https://api.lanyard.rest/v1/users/1040303561847881729")
            .then((response) => response.json())
            .then((data) => {
              const profileHash = data.data.discord_user.avatar;
              if (profileHash) {
                profileUrl = `https://cdn.discordapp.com/avatars/1040303561847881729/${profileHash}.webp`;
              }

              fetch(profileUrl, { cache: "reload" });
              document.querySelector(".center-circle").style.backgroundImage = `url("${profileUrl}")`;
              updateRedirect(profileUrl);
            });
        } catch (err) {
          console.error("Error fetching profile:", err);
        }
      }

      async function preloadAssets() {
        try {
          const baseUrl = "https://yunexiz.is-a.dev";

          const response = await fetch(`${baseUrl}/assets/manifest.json`);
          const manifest = await response.json();

          const assets = [
            baseUrl,
            ...manifest.images,
            ...manifest.data,
            ...manifest.css,
            ...manifest.js,
          ].map((asset) =>
            asset.startsWith("http") ? asset : `${baseUrl}${asset}`
          );

          await Promise.all(
            assets.map((asset) => fetch(asset, { cache: "reload" }))
          );

          if (manifest.images.includes("/assets/images/back-ground.webp")) {
            document.body.style.backgroundImage = `url('${baseUrl}/assets/images/back-ground.webp')`;
          }

          console.log("Assets cached successfully:", assets);
        } catch (err) {
          console.error("Error caching assets:", err);
        }
      }

      const updateRedirect = (profileUrl) => {
        const elapsedTime = Date.now() - startTime;
        const remainingTime = Math.max(0, 3000 - elapsedTime);

        if (timeoutId) clearTimeout(timeoutId);

        timeoutId = setTimeout(() => {
          urlParams.set("profileUrl", profileUrl);
          const redirectUrl = `https://yunexiz.is-a.dev?${urlParams.toString()}`;
          window.location.replace(redirectUrl);
        }, remainingTime);
      };

      const cacheParam = urlParams.get("cache");
      if (cacheParam === null || cacheParam !== "false") {
        prefetchProfile();
        preloadAssets();
      }
    </script>
  </head>
  <body>
    <div class="loader">
      <div class="center-circle"></div>
      <div class="orbit-circle"></div>
      <div class="orbit-circle opposite"></div>
      <div class="orbit-path"></div>
    </div>
    <span>One moment...</span>
  </body>
</html>
